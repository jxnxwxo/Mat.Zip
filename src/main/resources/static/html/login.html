<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <meta content="width=device-width, initial-scale=1.0" name="viewport">
  
 <!-- jQuery library -->
 <!-- <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>-->
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
 <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
 
 <script type="text/javascript" src="../js/my.js"></script>
 
 <link rel="stylesheet" type="text/css" href="../css/login.css">
 <link rel="stylesheet" type="text/css" href="../css/style.css">
	
 <!-- Bootstrap -->
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
		
 <!-- 네이버로그인 -->
 <script type="text/javascript" src="https://static.nid.naver.com/js/naverLogin_implicit-1.0.3.js" charset="utf-8"></script>
 <!-- <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>  -->	
 <!-- 카카오로그인 -->
 <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
 
 <script>
  $(document).ready(function(){
		var login=$.cookie('logined');	
			
		$.ajax({
			url:"login.html",
			type:"get",
			success:function(data){
				if(login != null){
				location.href = "http://13.125.123.80:8090/index.html";
				}
			}
		});
	});
 </script>
  
 <title>미쉐린 가이드:서울 x 맛.ZIP - 로그인</title>
 <meta content="" name="description">
 <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="../img/favicon.png" rel="icon">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="vendor/icofont/icofont.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="css/style.css" rel="stylesheet">
</head> 
  </head>

  <body>
  <header id="header" class="fixed-top">
    <div class="container-fluid">
       <div class="logo float-left">
          <a href="../index.html" class="logo mr-auto"><img src="../img/matzip_blk.png" alt=""></a>
      </div>
      <div class="row justify-content-center float-right">
        <div class="col-xl-10 d-flex align-items-center">
        </div>
      </div>
    </div>
  </header>
    <section id="hero">
    <div class="hero-container">
    <div class="container">
    <form action="index.html" method="post" class="loginForm">
      <h2>로그인</h2>
      <div class="idForm">
        <input type="text" id="id" class="id" placeholder="아이디">
      </div>
      <div class="passForm">
        <input type="password" id="pw" class="pw" placeholder="패스워드">
      </div>
      <div id="divBtn">
      <button type="button" class="btn" id="loginBtn">로그인</button>
      <button type="button" class="btn" id="etcBtn" onClick="window.open('/html/signUp.html','_blank','toolbar=no,location=no,status=no,menubar=no, scrollbars=auto,resizable=no,directories=no, width=500, height=750, top=150, left=1250')">회원가입</button>
      </div>
      
	  <div id="divBtn">
        <!-- 네이버 로그인 -->
		<!-- 네이버아이디로로그인 버튼 노출 영역 -->
		<span id="naver_id_login" style="margin:9px;"></span>
		<!-- //네이버아이디로로그인 버튼 노출 영역 -->
		<script type="text/javascript">
			  	var naver_id_login = new naver_id_login("In2RfOk3uk_RW1j6PS9s", "http://13.125.123.80:8090/html/naver_callback.html");
			  	var state = naver_id_login.getUniqState();
			  	naver_id_login.setButton("green", 4, 41);
			  	naver_id_login.setDomain("http://13.125.123.80:8090/html/login.html");
			  	naver_id_login.setState(state);
			  	naver_id_login.setPopup();
			  	naver_id_login.init_naver_id_login();
		</script>
        <span><button type="button" class="btn" id="etcBtn" onClick="window.open('/html/findId.html','_blank','toolbar=no,location=no,status=no,menubar=no, scrollbars=auto,resizable=no,directories=no, width=500, height=350, top=150, left=1250')">아이디 찾기</button></span>
      </div>
       <div id="divBtn">
		<!-- 카카오 로그인 -->
		<span>
		<a href="javascript:kakaoLogin();">
		<img src="../img/kakaologin2.png"style="height: 44px; width: 207px;" /></a>
		</span>
		<script>
			    window.Kakao.init("37223039a87380dfed3030afb8ccef0c");
			    
			    function kakaoLogin() {
			      window.Kakao.Auth.login({
			        scope:'profile_nickname, account_email, birthday',
			        success: function(authObj) {
			         	console.log(authObj);
			          	window.Kakao.API.request({
			           		url:'/v2/user/me',
			            	success: res => {
			              	const kakao_account = res.kakao_account;
			              	/* console.log(kakao_account);
			              	console.log(kakao_account.email);
			              	console.log(kakao_account.birthday);
			              	console.log(kakao_account.profile.nickname); */
			              	
			     // customer 세팅
			     let id = kakao_account.email.split('@');
			     id = id[0];
			     let pw = kakao_account.birthday;
			     const email = kakao_account.email;
			     const nickname = kakao_account.profile.nickname;
			     console.log(id + " " + pw + " " + email + " " + nickname);
			     
			     
			     $.ajax({
					url:"/customerIdChk",
					type:"post",
					data: { id:id },
					success:function(result){
						if(result != 'fail'){
							
							$.ajax({
							 url:"/customerInsert",
							 type:"post",
							 data:{ id:id, pw:pw, email:email, nickname:nickname },
							 success:function(data){
							  
									  $.ajax({
										 url:"/login",
										 type:"post",
										 data: { id:id, pw:pw },
										 success:function(data){
											$.cookie('logined', data.id, { path: '/' });
										  	data = "<div>" + data.nickname + "님   <a id='mypageBtn' class='btn scrollto text-light'>마이페이지</a><a type='button' value='logout' id='logoutBtn' class='btn scrollto text-light'>로그아웃</a>";
										  	$.cookie('tempdata', data, { path: '/' });
										  	location.reload();
											}
									  	});
									  }
									 });
									}else {
										   alert("이미 가입하신 기록이 있습니다.\nID: kakao 아이디(메일주소를 제외한 영문)\nPW: 생년월일 4자리(ex.1월1일이라면, 0101)\n입력 후 로그인해주세요.");  
										   //opener.parent.location.replace("/html/login.html");
										   window.close();
										   return false;
									 	   }
								  },
								  error:function(){
										alert("알수 없는오류입니다.\n다시 시도해주세요.");  
										}
						  		});
			             	 }
			      		});
			    	  }
			      });
			    }
		  </script>
        <span>
        <button type="button" class="btn" id="etcBtn" onClick="window.open('/html/findPw.html','_blank','toolbar=no,location=no,status=no,menubar=no, scrollbars=auto,resizable=no,directories=no, width=500, height=350, top=150, left=1250')">비밀번호 찾기</button>
        </span>
      </div>
    </form>
	</div>
    </div>
    </section>
	<!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>눈이 침침하조</span></strong>. All Rights Reserved
      </div>
    </div>
  </footer><!-- End #footer -->

</body>
</html>